RM=@RM@
CC=@CC@
RANLIB=@RANLIB@
CFLAGS=@CFLAGS@ @OPTIM@
LIBS=../libapr.a @LIBS@ 
LDFLAGS=@LDFLAGS@ $(LIBS)
INCDIR=../include
INCLUDES=-I$(INCDIR)
MKDEP=../helpers/mkdep.sh

TARGETS= testmd5@EXEEXT@ \
	testfile@EXEEXT@ \
	testflock@EXEEXT@ \
	testproc@EXEEXT@ \
	testsock@EXEEXT@ \
	testsf@EXEEXT@ \
	testthread@EXEEXT@ \
	testtime@EXEEXT@ \
	testargs@EXEEXT@ \
	testcontext@EXEEXT@ \
	testmmap@EXEEXT@ \
	testshmem@EXEEXT@ \
	testpipe@EXEEXT@ \
	testdso@EXEEXT@ \
	testoc@EXEEXT@ \
	testuuid@EXEEXT@ \
	occhild@EXEEXT@ \
	mod_test.so

OBJS= testmd5.o \
	testfile.o \
	testflock.o \
	testproc.o \
	testsock.o \
	testsf.o \
	testthread.o \
	testtime.o \
        testargs.o \
        testcontext.o \
	testmmap.o \
	testdso.o \
	testoc.o \
	testuuid.o \
	occhild.o \
	mod_test.o

.c.o:
	$(CC) -c $(CFLAGS) $(INCLUDES) $<

all: $(TARGETS) 

testmd5@EXEEXT@: testmd5.o
	$(CC) $(CFLAGS) -o testmd5@EXEEXT@ testmd5.o $(LDFLAGS)

testfile@EXEEXT@: testfile.o
	$(CC) $(CFLAGS) -o testfile@EXEEXT@ testfile.o $(LDFLAGS) 

testflock@EXEEXT@: testflock.o
	$(CC) $(CFLAGS) -o testflock@EXEEXT@ testflock.o $(LDFLAGS) 

testdso@EXEEXT@: testdso.o
	$(CC) $(CFLAGS) --export-dynamic -fPIC testdso.o -o testdso@EXEEXT@ $(LDFLAGS) 

testoc@EXEEXT@: testoc.o
	$(CC) $(CFLAGS) -o testoc@EXEEXT@ testoc.o $(LDFLAGS) 

occhild.so: occhild.o
	$(CC) -shared occhild.o -o occhild.so 

mod_test.so: mod_test.o
	$(CC) -shared mod_test.o -o mod_test.so 

testargs@EXEEXT@: testargs.o
	$(CC) $(CFLAGS) -o testargs@EXEEXT@ testargs.o $(LDFLAGS) 

testcontext@EXEEXT@: testcontext.o
	$(CC) $(CFLAGS) -o testcontext@EXEEXT@ testcontext.o $(LDFLAGS) 

testproc@EXEEXT@: testproc.o
	$(CC) $(CFLAGS) -o testproc@EXEEXT@ testproc.o $(LDFLAGS)

testthread@EXEEXT@: testthread.o
	$(CC) $(CFLAGS) -o testthread@EXEEXT@ testthread.o $(LDFLAGS)

testsock@EXEEXT@: testsock.o client.o server.o 
	$(CC) $(CFLAGS) -o testsock@EXEEXT@ testsock.o $(LDFLAGS)
	$(CC) $(CFLAGS) -o server@EXEEXT@ server.o $(LDFLAGS) 
	$(CC) $(CFLAGS) -o client@EXEEXT@ client.o $(LDFLAGS)

testsf@EXEEXT@: testsf.o
	$(CC) $(CFLAGS) -o testsf@EXEEXT@ testsf.o $(LDFLAGS)

testtime@EXEEXT@: testtime.o
	$(CC) $(CFLAGS) -o testtime@EXEEXT@ testtime.o $(LDFLAGS)

testmmap@EXEEXT@: testmmap.o
	$(CC) $(CFLAGS) -o testmmap@EXEEXT@ testmmap.o $(LDFLAGS)

testshmem@EXEEXT@: testshmem.o
	$(CC) $(CFLAGS) -o testshmem@EXEEXT@ testshmem.o $(LDFLAGS)

testpipe@EXEEXT@: testpipe.o
	$(CC) $(CFLAGS) -o testpipe@EXEEXT@ testpipe.o $(LDFLAGS)

testuuid@EXEEXT@: testuuid.o
	$(CC) $(CFLAGS) -o testuuid@EXEEXT@ testuuid.o $(LDFLAGS)

clean:
	$(RM) -f *.o *.a *.so $(TARGETS) testflock.tmp

distclean: clean
	-$(RM) -f Makefile

depend:
	$(MKDEP) $(INCLUDES) $(CFLAGS) *.c

# DO NOT REMOVE
