#
# APR (Apache Portable Runtime) library Makefile.
#
SHELL=@SH@

#
# Macros for compilation commands
#
@SET_MAKE@
RM=@RM@
CC=@CC@
CFLAGS=@CFLAGS@ @OPTIM@
LIBS=@LIBS@
LDFLAGS=@LDFLAGS@ $(LIBS)
RANLIB=@RANLIB@
#
# Macros for supporting directories
#
INCDIR=./include
INCDIR1=../include
INCLUDES=-I$(INCDIR) -I$(INCDIR1)

#
# Macros for target determination
#
MODULES=lib file_io network_io threadproc locks misc time signal
SUBDIRS=lib file_io/@OSDIR@ network_io/@OSDIR@ threadproc/@OSDIR@ \
        locks/@OSDIR@ misc/@OSDIR@ time/@OSDIR@ signal/@OSDIR@ 
#shmem/@OSDIR@

#
# Rules for turning inputs into outputs
#
.c.o:
	$(CC) $(CFLAGS) -c $(INCLUDES) $<

#
# Rules for building specific targets, starting with 'all' for
# building the entire package.
#
all: Makefile $(MODULES) subdirs
	rm -Rf libs
	mkdir libs
	@for i in $(SUBDIRS); do cp $$i/*.a libs ; done;
	@echo APR built.

clean: subdirs_clean
	$(RM) -f *.o *.a *.so

depend: subdirs_depend

distclean: clean
	-$(RM) -f Makefile

subdirs:
	@for i in $(SUBDIRS); do \
	    echo "===> $$i"; \
	    ( cd $$i && $(MAKE) $(MFLAGS_STATIC) SDP='$(SDP)' \
		CC='$(CC)' AUX_CFLAGS='$(AUX_CFLAGS)' RANLIB='$(RANLIB)' ) \
		|| exit 1; \
	    echo "<=== $$i"; \
	done;

subdirs_depend:
	@for i in $(SUBDIRS); do \
	    echo "===> $$i"; \
	    ( cd $$i && $(MAKE) depend ) \
		|| exit 1; \
	    echo "<=== $$i"; \
	done;

subdirs_clean:
	@for i in $(SUBDIRS); do \
	    echo "===> $$i"; \
	    ( cd $$i && $(MAKE) clean ) \
		|| exit 1; \
	    echo "<=== $$i"; \
	done;

# DO NOT REMOVE
