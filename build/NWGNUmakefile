#
# Declare the sub-directories to be built here
#

SUBDIRS = \
	$(EOLIST) 

#
# Get the 'head' of the build environment.  This includes default targets and
# paths to tools
#

include $(APR_WORK)/build/NWGNUhead.inc

#
# build this level's files

FILES_prebuild_headers = \
	$(APR)/include/apr.h \
	$(APR)/include/apu.h \
	$(APR)/include/apu_want.h \
	$(APR)/include/apr_ldap.h \
	$(APR)/include/private/apu_config.h \
	$(APR)/include/private/apu_select_dbm.h \
	$(EXPAT_SRC)/lib/config.h \
	$(EXPAT_SRC)/lib/expat.h \
	$(EOLIST)
#	$(APRXML)/expat_config.h \
    
nlms :: $(APR)/aprlib.imp

$(APR)/aprlib.imp : make_nw_export.awk nw_export.i
	@echo Generating $@
	$(AWK) -v EXPPREFIX=APR$(VERSION_MAJMIN) -f $^ | sort >$@
    
nw_export.i : nw_export.inc $(FILES_prebuild_headers) $(NLM_NAME)_cc.opt
	@echo Generating $@
	$(CC) $< @$(NLM_NAME)_cc.opt

$(NLM_NAME)_cc.opt : NWGNUmakefile $(APR)/build/NWGNUenvironment.inc $(APR)/build/NWGNUhead.inc $(APR)/build/NWGNUtail.inc $(CUSTOM_INI)
	$(CHK) $@ $(DEL) $@
	@echo -P >> $@
	@echo -EP >> $@
	@echo -nosyspath >> $@
	@echo -w nocmdline >> $@
	@echo $(DEFINES) -DGENEXPORTS >> $@
	@echo -I$(APR)/include >> $@
	@echo -I$(APR)/include/arch/netware >> $@
	@echo -I$(APR)/include/arch/unix >> $@
	@echo -I$(APR)/build >> $@
	@echo -ir $(NOVELLLIBC) >> $@
ifneq "$(LDAPSDK)" ""
	@echo -ir $(LDAPSDK) >> $@
endif

$(APR)/include/%.h: $(APR)/include/%.hnw
	@echo Creating $@
	$(CP) $(subst /,\,$<) $(subst /,\,$@)

$(APR)/include/private/%.h: $(APR)/include/private/%.hnw
	@echo Creating $@
	$(CP) $(subst /,\,$<) $(subst /,\,$@)

$(APR)/include/private/%.h: $(APR)/include/private/%.hw 
	@echo Creating $@
	$(CP) $(subst /,\,$<) $(subst /,\,$@)

#$(APRXML)/%.h: $(APRXML)/%.hnw
#	@echo Creating $@
#	$(CP) $(subst /,\,$<) $(subst /,\,$@)

$(EXPAT_SRC)/lib/%.h: $(EXPAT_SRC)/lib/%.hnw
	@echo Creating $@
	$(CP) $(subst /,\,$<) $(subst /,\,$@)

$(EXPAT_SRC)/lib/%.h: $(EXPAT_SRC)/lib/%.h.in
	@echo Creating $@
	$(CP) $(subst /,\,$<) $(subst /,\,$@)

$(APR)/include/private/apu_config.h: FORCE

#
# You can use this target if all that is needed is to copy files to the
# installation area
#
install :: nlms FORCE


clean ::
	$(CHK) nw_export.i                                          $(DEL) nw_export.i
	$(CHK) $(NLM_NAME)_cc.opt                                   $(DEL) $(NLM_NAME)_cc.opt
	$(CHK) NWGNUversion.inc                                     $(DEL) NWGNUversion.inc
	$(CHK) $(subst /,\,$(APR))\include\apr.h                    $(DEL) $(subst /,\,$(APR))\include\apr.h
	$(CHK) $(subst /,\,$(APR))\include\apu.h                    $(DEL) $(subst /,\,$(APR))\include\apu.h
	$(CHK) $(subst /,\,$(APR))\include\apu_want.h               $(DEL) $(subst /,\,$(APR))\include\apu_want.h
	$(CHK) $(subst /,\,$(APR))\include\apr_ldap.h               $(DEL) $(subst /,\,$(APR))\include\apr_ldap.h
	$(CHK) $(subst /,\,$(APR))\include\private\apu_config.h     $(DEL) $(subst /,\,$(APR))\include\private\apu_config.h
	$(CHK) $(subst /,\,$(APR))\include\private\apu_select_dbm.h $(DEL) $(subst /,\,$(APR))\include\private\apu_select_dbm.h
	$(CHK) $(subst /,\,$(APR))\aprlib.imp                       $(DEL) $(subst /,\,$(APR))\aprlib.imp
	$(CHK) $(subst /,\,$(EXPAT_SRC))\config.h                   $(DEL) $(subst /,\,$(EXPAT_SRC))\config.h
	$(CHK) $(subst /,\,$(EXPAT_SRC))\expat.h                    $(DEL) $(subst /,\,$(EXPAT_SRC))\expat.h
#	$(CHK) $(subst /,\,$(APRXML))\expat_config.h                $(DEL) $(subst /,\,$(APRXML))\expat_config.h

#
# Include the 'tail' makefile that has targets that depend on variables defined
# in this makefile
#

include $(AP_WORK)\build\NWGNUtail.inc
    
