#!/bin/sh

#
# Build aclocal.m4 from libtool's libtool.m4 and our own M4 files.
#
libtoolize=`build/PrintPath glibtoolize libtoolize`
ltpath=`dirname $libtoolize`
ltfile=`cd $ltpath/../share/aclocal ; pwd`/libtool.m4
echo "Incorporating $ltfile into aclocal.m4 ..."
cat > aclocal.m4 <<EOF
dnl THIS FILE IS AUTOMATICALLY GENERATED BY buildconf
dnl Edits here will be lost

sinclude(build/apr_common.m4)
sinclude(build/apr_network.m4)
sinclude(build/apr_threads.m4)
sinclude(build/apr_hints.m4)

EOF
cat $ltfile >> aclocal.m4

#
# Create the libtool helper files
#
# Note: we copy (rather than link) them to simplify distribution.
# Note: APR supplies its own config.guess and config.sub -- we do not
#       rely on libtool's versions
#
echo "Copying libtool helper files ..."
$libtoolize --copy --automake

#
# Generate the autoconf header and ./configure
#
echo "Creating include/arch/unix/apr_private.h.in ..."
autoheader

echo "Creating configure ..."
### do some work to toss config.cache?
autoconf

(cd shmem/unix/mm && autoconf)
